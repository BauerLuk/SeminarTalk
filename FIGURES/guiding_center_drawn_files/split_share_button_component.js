define(["require","exports","tslib","classnames","react-redux","react","spectrum/button","spectrum/popover","spectrum/tooltip","modules/clean/filepath","modules/clean/react/extensions/file","modules/clean/integrations/data/selectors","modules/clean/react/app_actions/apis","modules/clean/react/app_actions/redirect","modules/clean/react/app_actions/education/types","modules/clean/react/app_actions/telemetry_client","modules/clean/react/css","modules/clean/react/extensions/connect_flow","modules/clean/react/extensions/data/action_creators","modules/clean/react/extensions/data/selectors","modules/clean/react/extensions/data/store","modules/clean/react/extensions/data/types","modules/clean/react/extensions/tooltips","modules/clean/react/extensions/extensions_scaling_modal","modules/clean/react/extensions/utils","modules/clean/react/extensions/extensions_utils","modules/clean/react/extensions/data/helpers","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer/open_button/types","modules/clean/react/file_viewer_sidebar/buttons/icon","modules/clean/react/portal_popover","modules/clean/static_urls","modules/constants/file_viewer","modules/core/i18n","external/lodash","modules/clean/react/extensions/menu_content_item","modules/clean/cloud_docs/constants","modules/clean/react/extensions/common","modules/clean/user_education/react/user_education_effect","modules/clean/react/file_viewer/constants"],(function(e,t,n,o,r,i,a,s,l,p,c,u,d,h,g,_,f,m,S,v,A,O,P,T,E,I,y,x,b,C,N,M,w,L,k,B,D,F,U,H,R,V){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importDefault(o),i=n.__importStar(i);var G="TOOLTIP_ONLY"===k.FILES_2_COLLAPSED_SHARE_COPY_TOOLTIP_CHANGES,q="COPY_ONLY"===k.FILES_2_COLLAPSED_SHARE_COPY_TOOLTIP_CHANGES,Y="COPY_AND_TOOLTIP"===k.FILES_2_COLLAPSED_SHARE_COPY_TOOLTIP_CHANGES;A.getStore();var Z=(function(t){function r(r){var p=t.call(this,r)||this;return p.handleClickShare=function(e){e.preventDefault(),p.props.onShowShare(),p.props.logShareButtonClick&&p.props.logShareButtonClick(),p.currentSession&&p.currentSession.event("click_share",{trigger_type:p.props.triggerType}),e.stopPropagation()},p.handleSelectAction=function(e,t){t.preventDefault(),e.handler(),p.props.logShareButtonClick&&p.props.logShareButtonClick(e.userAction),H.logEvent(p.currentSession,"select_action",{type:e.type,trigger_type:p.props.triggerType}),t.stopPropagation()},p.handlePreventMouseDown=function(e){e.preventDefault(),p.state.tooltipState===g.TooltipState.BIG_ONBOARDING_TOOLTIP&&(p.markSplitShareTooltipViewed(),p.setState({tooltipState:g.TooltipState.NO_TOOLTIP})),e.stopPropagation()},p.handlePopoverHover=function(){p.currentSession&&p.currentSession.event("popover_trigger_hover",{trigger_type:p.props.triggerType})},p.handleShareHover=function(){p.currentSession&&p.currentSession.event("share_hover",{trigger_type:p.props.triggerType})},p.handlePopoverToggle=function(e){var t=e.isOpen,n=p.props,o=n.onDropdownOpen,r=n.onDropdownClose,i=n.triggerType,a=n.isCollapsed;if(t&&o?o():!t&&r&&r(),p.currentSession&&p.currentSession.event(t?"open_popover":"close_popover",{trigger_type:i}),t){var s=a?x.EventType.SidebarCollapsedShareClicked:x.EventType.SidebarOpenedShareClicked;b.filePreviewEventEmitter.emit(s,C.FilePreviewSession.currentSession)}},p.handlePresentInZoom=function(e,t){var n=p.props,o=n.refreshSharingServiceInfo,r=n.sharingServiceInfo,i=n.onPresentInZoom,a=n.landingPageEnabled;r&&o&&i&&m.presentInZoomFlow(e,r,o,i,"split_share_button",a,t)},p.handleShareInSlack=function(e,t,n){var o=p.props,r=o.refreshSharingServiceInfo,i=o.sharingServiceInfo,a=o.landingPageEnabled;i&&r&&m.shareInSlackFlow(t,i,r,e,"split_share_button",a,n)},p.handleShareToTrello=function(e,t,n){var o=p.props,r=o.refreshSharingServiceInfo,i=o.sharingServiceInfo,a=o.landingPageEnabled;i&&r&&m.shareInTrelloFlow(t,i,r,e,"split_share_button",a,n)},p.handleUploadToCanvas=function(e,t,n){var o=p.props,r=o.refreshSharingServiceInfo,i=o.sharingServiceInfo,a=o.landingPageEnabled;i&&r&&m.shareInCanvasFlow(t,i,r,e,"split_share_button",a,n)},p.handleUpdateLinkState=function(e,t){(0,p.props.updateLinkState)({actionId:e,linkState:t})},p.handleAppAction=function(e,t,n){var o=p.props,r=o.context,i=o.featureFlags;h.redirectToActionOrShowAuth(t,e,n,i,r,p.handleUpdateLinkState,p.handleShareAction),H.logEvent(p.currentSession,"select_action",H.getAppActionExtras(n))},p.handleShareAction=function(e,t,n){var o=n.handler.service_type[".tag"],r={".tag":"profile_linked"},i=function(){p.handleUpdateLinkState(n.id,r),h.authorizeNoRedirect(e,n.id)};switch(o){case"slack_dropbox":return p.handleShareInSlack(t,e,i);case"zoom":return p.handlePresentInZoom(e,i);case"trello":return p.handleShareToTrello(t,e,i);case"canvas":return p.handleUploadToCanvas(t,e,i)}},p.getAppActionIconUrl=function(e){var t=e.icon;return t&&t.url&&!t.is_static?t.url:L.static_url("/static/images/generic_app_icon-vflIPYT1H.png")},p.getAppActionOpenOptionActions=function(e){var t=e.handler;if("profile_service"!==t[".tag"])return{type:N.OpenButtonAction.APP_ACTION,userAction:x.UserAction.ShareToAction};switch(t.service_type[".tag"]){case"slack_dropbox":return{type:N.OpenButtonAction.SHARE_TO_SLACK,userAction:x.UserAction.ShareToSlack};case"zoom":return{type:N.OpenButtonAction.PRESENT_IN_ZOOM,userAction:x.UserAction.PresentInZoom};case"trello":return{type:N.OpenButtonAction.SHARE_TO_TRELLO,userAction:x.UserAction.ShareToTrello};default:return{type:N.OpenButtonAction.APP_ACTION,userAction:x.UserAction.ShareToAction}}},p.handleHellosignDeepIntegrationLaunch=function(t,o){return new Promise((function(t,n){e(["modules/clean/integrations/hellosign_deep_integration/launcher"],t,n)})).then(n.__importStar).then((function(e){var n=(0,e.getLauncher)();return n.init({entryPoint:"share_menu",file:t,user:o}),n})).then((function(e){return e.launch(),e}))},p.getHellosignOpenOption=function(e,t){return{handler:function(){return p.handleHellosignDeepIntegrationLaunch(e,t)},iconUrl:L.static_url("/static/images/integrations/hellosign/signature-vflBGJCuJ.svg"),spriteName:null,text:B.intl.formatMessage({id:"KPapIP",defaultMessage:"Send for signature"}),type:N.OpenButtonAction.PREPARE_FOR_SIGNATURE,userAction:x.UserAction.ShareToAction}},p.getAppActionOpenOption=function(e,t,n){var o=p.getAppActionOpenOptionActions(n),r=o.type,i=o.userAction;return{handler:function(){p.handleAppAction(e,t,n)},spriteName:null,text:n.description,type:r,userAction:i,iconUrl:p.getAppActionIconUrl(n)}},p.getMoreAppsOpenOption=function(e,t){return{handler:function(){p.handleMoreApps(e,t),H.logEvent(p.currentSession,"select_show_more",{})},text:B.intl.formatMessage({id:"Gevpqz",defaultMessage:"Connect more apps"}),type:N.OpenButtonAction.OPEN_MORE_APPS,userAction:x.UserAction.OpenMoreApps,spriteName:null}},p.getAddAppsOpenOption=function(e,t){return{handler:function(){p.handleMoreApps(e,t),H.logEvent(p.currentSession,"select_add_apps",{})},text:B.intl.formatMessage({id:"XFA09U",defaultMessage:"Connect apps"}),type:N.OpenButtonAction.OPEN_ADD_APPS,userAction:x.UserAction.OpenAddApps,spriteName:null,iconUrl:L.static_url("/static/images/extensions/circled_plus-vfl7N2-Lg.svg")}},p.handleMoreApps=function(e,t){var n=p.props,o=n.appActions,r=n.featureFlags,i=n.context,a=n.categoryInfo,s=I.getCategoryIdToInfos(a);T.showExtensionsScalingModal(B.intl.formatMessage({id:"A7cFjC",defaultMessage:"Share with these apps"}),t,e,o.sort(y.actionCompareFn),s,r,p.handleUpdateLinkState,i,p.currentSession,p.handleShareAction)},p.getShareWithEmailOpenOption=function(){return{handler:p.props.onShowShare,spriteName:null,text:B.intl.formatMessage({id:"8U/qbn",defaultMessage:"Share with Dropbox"}),type:N.OpenButtonAction.INVITE_VIA_EMAIL,userAction:x.UserAction.InviteViaEmail,iconUrl:L.static_url("/static/images/extensions/shared_medium-vfldEW5Iw.svg")}},p.getPopoverTriggerRenderer=function(e,t,n){return function(){var r=q||Y?i.default.createElement("img",{alt:"",src:L.static_url("/static/images/extensions/shared_light-vfl8nVEY_.svg")}):i.default.createElement(M.ButtonIcon,{isPrimary:"primary"===p.getButtonVariant(),name:"share","aria-label":n}),s=i.default.createElement(a.Button,{className:o.default("extensions-split-share-menu__trigger",{"extensions-split-share-menu__trigger--collapsed":e}),tagName:"span",tabIndex:t?void 0:-1,variant:p.getButtonVariant(),onMouseEnter:p.handlePopoverHover,"aria-label":B.intl.formatMessage({id:"5MpLpV",defaultMessage:"Expand share menu"})},e?r:"â–¾");return(G||Y)&&e?i.default.createElement(l.Tooltip,{positionOffset:8,positioning:"left",tooltipContent:B.intl.formatMessage({id:"TFeNOo",defaultMessage:"Share"})},s):s}},p.getPopoverItemRenderer=function(){return function(){var e=p.props,t=e.user,o=e.file,r=e.appActions,a=e.nonHellosignAppActions,l=e.featureFlags,u=l.expSplitShareBtn,d=l.hellosignDeepIntegration,h=p.getShareWithEmailOpenOption(),g="DEEP_INTEGRATION"===d,_=U.isHellosignFileByExtension(c.getFileExt(n.__assign(n.__assign({},o),{bytes:0}))),f=null,m=r;if(g&&_){m=a;var S=p.getHellosignOpenOption(o,t);f=i.default.createElement(F.MenuContentItem,{openOption:S})}var v="ON_SHOW_INVITE"===u?i.default.createElement(F.MenuContentItem,{openOption:h}):null,A=v||f?i.default.createElement(i.Fragment,null,v,f,i.default.createElement(s.PopoverItemGroupSeparator,null)):null,O=y.partitionActions(m),P=O.installedActions,T=O.unpromotedActions,E=D.isEmpty(P)?null:P.map((function(e){var n=p.getAppActionOpenOption(o,t,e);return i.default.createElement(F.MenuContentItem,{key:n.text,openOption:n})})),I=D.isEmpty(T)?null:i.default.createElement(F.MenuContentItem,{openOption:D.isEmpty(P)?p.getAddAppsOpenOption(o,t):p.getMoreAppsOpenOption(o,t)});return i.default.createElement(i.Fragment,null,A,E,I)}},p.markSplitShareTooltipViewed=function(){d.markTooltipViewed(p.props.user.id,"split_share_edu")},p.state={tooltipState:g.TooltipState.NO_TOOLTIP},p.telemetryClient=_.createTelemetryClient(n.__assign({component:"split-share-btn"},r.context)),p}return n.__extends(r,t),r.prototype.componentDidMount=function(){this.props.showEduTooltip&&this.setEduTooltip()},r.prototype.setEduTooltip=function(){return n.__awaiter(this,void 0,void 0,(function(){var e,t;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,d.getTooltipHistory(this.props.user.id,["open_with_edu","split_share_edu"])];case 1:return e=n.sent(),t=P.allowedTooltips(this.props.appActions.length>0,this.props.file.fq_path?"."+p.file_extension(p.filename(this.props.file.fq_path)):"",this.props.featureFlags),"split_share_edu"===t.find((function(t){return void 0!==e[t]&&!e[t]}))&&this.setState({tooltipState:g.TooltipState.BIG_ONBOARDING_TOOLTIP}),[2]}}))}))},r.prototype.getButtonVariant=function(){var e=this.props,t=e.isVisible,n=e.variant;return n&&t?n:"invisible"},r.prototype.render=function(){var e=this.props,t=e.file,n=e.context,r=e.isVisible,l=e.shareButtonLabel,c=e.triggerType,u=e.isCollapsed,d=e.shouldUsePortalPopover,h=e.appActions,g=e.scrollableSidebarRef,f=e.featureFlags,m="ON_SHOW_INVITE"===(null==f?void 0:f.expSplitShareBtn)||!D.isEmpty(h);n?this.currentSession=this.telemetryClient.session({ext:_.getPiiSafeExtension(t?"."+p.file_extension(p.filename(t.fq_path)):"")}):delete this.currentSession;var S=o.default("extensions-split-share__share-button",{"primary-action-menu__button":c===O.TriggerType.SidebarPrimaryButton,"extensions-inline-share-button":m,"action-share":!m}),v=i.default.createElement(a.Button,{"aria-label":l,className:S,onClick:this.handleClickShare,tabIndex:r?void 0:-1,variant:this.getButtonVariant(),onMouseEnter:this.handleShareHover},i.default.createElement(R.UserEducationEffect,{containerName:"SplitShareButton",name:"ShareButtonLabel",useSpan:!0},l)),A=this.getPopoverTriggerRenderer(u,r,l),P=this.getPopoverItemRenderer(),T=d?i.default.createElement(w.PortalPopover,{className:"extensions-split-share__popover",popoverTriggerSelector:".extensions-split-share-menu__trigger",renderPopoverTrigger:A,renderPopoverItems:P,scrollableContainer:g,onSelection:this.handleSelectAction,onMenuToggle:this.handlePopoverToggle,onClick:this.handlePreventMouseDown,onDoubleClick:this.handlePreventMouseDown}):i.default.createElement(s.Popover,{className:"extensions-split-share__popover",onClick:this.handlePreventMouseDown,onDoubleClick:this.handlePreventMouseDown,onSelection:this.handleSelectAction,onMenuToggle:this.handlePopoverToggle,closeOnSelection:!0},i.default.createElement(s.PopoverTrigger,null,A()),i.default.createElement(s.PopoverContent,{position:"below",attachment:"right"},P())),I=this.props.sharingServiceInfo&&E.isSlackAvailable(this.props.sharingServiceInfo)&&E.isZoomAvailable(this.props.sharingServiceInfo);return i.default.createElement("div",{className:o.default("extensions-split-share-btn",{"extensions-split-share-btn--invisible":!r,"slack-zoom-available":I&&!u,"slack-zoom-available-collapsed":I&&u,"wopi-available":("V1_WOPI"===(null==f?void 0:f.cloudDocPrompt)||"V2_AGNOSTIC"===(null==f?void 0:f.cloudDocPrompt))&&U.isMicrosoftFileByExtension(p.file_extension(p.filename(this.props.file.fq_path)))&&!u})},u?null:v,m?T:null)},r.defaultProps={isVisible:!0,shareButtonLabel:B.intl.formatMessage({id:"TFeNOo",defaultMessage:"Share"}),triggerType:O.TriggerType.PrimaryButton,variant:"secondary"},r})(i.default.Component);t.SplitShareButtonComponent=Z;var z={refreshSharingServiceInfo:S.refreshSharingServiceInfoAdapter,updateLinkState:S.updateLinkState},W=r.connect((function(e,t){return{appActions:v.getShareActionsForFile(e,n.__assign(n.__assign({},t.file),{bytes:0})),nonHellosignAppActions:v.getNonHellosignActionsForFile(e,n.__assign(n.__assign({},t.file),{bytes:0}),V.HELLOSIGN_PROD_APP_ID),categoryInfo:v.getCategoryInfos(e),featureFlags:v.getFeatureFlags(e),sharingServiceInfo:v.getSharingServiceInfoAdapter(e),landingPageEnabled:u.isConnectServiceLandingPagesEnabled(e)}}),z)(Z);t.SplitShareButton=f.requireCssWithComponent(W,["/static/css/extensions/index-vflRLfsLb.css","/static/css/app_actions/index-vflL7QoxZ.css"])}));
//# sourceMappingURL=split_share_button_component.min.js-vflePXq58.map